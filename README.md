# Ollama Scanner

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

A C++ tool designed to scan a list of potential IP addresses and ports to identify running [Ollama](https://ollama.com/) instances. It takes input typically generated by `masscan` and verifies potential targets by probing the Ollama API endpoints (`/api/tags` and `/api/ps`).

## Features

*   Reads potential targets (IP and port) from a text file (Masscan grepable format).
*   Performs fast, concurrent initial verification checks against the `/api/tags` endpoint.
*   Interrogates positively identified instances to fetch installed models (`/api/tags`) and running models (`/api/ps`).
*   Reports detailed information about found instances, including installed/running model names, sizes, and quantization levels.
*   Configurable concurrency level for the initial scanning phase.

## Prerequisites

*   **CMake**: Version 3.11 or higher.
*   **C++ Compiler**: A compiler supporting C++23 (e.g., GCC 11+, Clang 14+, MSVC v19.34+/Visual Studio 2022 17.4+).
*   **Git**: Required by CMake's FetchContent to download dependencies.
*   **(Optional but typical for input)** [masscan](https://github.com/robertdavidgraham/masscan) or a file formatted like its `-oG` output.

## Building

The project uses CMake and FetchContent, which handles downloading and building dependencies automatically.

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/Sightem/ollama-scanner.git
    cd ollama-scanner
    ```

2.  **Configure using CMake:**
    ```bash
    cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
    ```
    *(On the first run, CMake will download and configure CPR, fmt, and nlohmann/json)*

3.  **Build the project:**
    ```bash
    cmake --build build
    ```

4.  **Locate the executable:**
    *   On Linux/macOS: `build/ollama_scanner`
    *   On Windows: `build\Release\ollama_scanner.exe` or `build\Debug\ollama_scanner.exe`

## Usage

Run the executable from your terminal, optionally providing the input file and concurrency level.

```bash
./ollama_scanner [input_file] [max_concurrent]
```

## Arguments: 
- `[input_file]`: (Optional) Path to the file containing scan targets. 
  - Format: One host/port per line, matching Masscan's grepable output (-oG). Lines starting with # are ignored. 
  - Example line: `Host: 192.168.1.100 () Ports: 11434/open/tcp////`
  - Default: res.txt (if present in the current directory)
- `[max_concurrent]`: (Optional) The maximum number of concurrent HTTP requests for the initial verification phase (Phase 1).
  - Default: 50


## Examples:
```bash
# Run with defaults (using res.txt if it exists, concurrency 500)
./build/ollama_scanner

# Run with a specific input file and default concurrency
./build/ollama_scanner masscan_output.txt

# Run with a specific input file and higher concurrency
./build/ollama_scanner masscan_output.txt 1000

# Show help message
./build/ollama_scanner -h
```

## Input File (res.txt or custom)
The tool expects an input file where each relevant line contains an IP address and an open port, typically generated by masscan. The parser specifically looks for lines matching the pattern: `Host: <IP_ADDRESS> (...) Ports: <PORT>/open/....`

Example `res.txt`:
```angular2html
# Masscan 1.3.2 scan initiated Tue May 14 10:00:00 2024
# Command: masscan 10.0.0.0/8 -p11434 --rate=10000 -oG res.txt
Host: 10.1.2.3 () Ports: 11434/open/tcp////
Host: 10.5.6.7 () Ports: 11434/open/tcp////
# Some other host comment
Host: 10.9.8.7 () Ports: 8080/open/tcp////
Host: 10.1.1.1 () Ports: 11434/open/tcp////
# Scan finished Tue May 14 10:05:00 2024
```

## Output
The output will be printed to the console and will look similar to:
```
Reading candidates from: res.txt
Read 1 candidates.
--- Phase 1: Initial Verification ---
Using max concurrency: 500
Probing endpoint: /api/tags
Timeout per request: 2000ms
-------------------------------------
[POTENTIAL] Ollama found at 10.10.10.10:11434 (Initial probe OK)
[Progress] Checked: 1/1, Potential: 1, Rate: 2.5 req/s
-------------------------------------
--- Phase 1 Complete ---
Checked 1 candidates in 0 seconds.
Found 1 potential Ollama instances.
--- Phase 2: Interrogating Potential Instances ---
Timeout per request: 5ms
--------------------------------------------------
Unique potential instances to interrogate: 1
[Interrogating] 10.10.10.10:11434...
[Progress] Interrogated: 1/1
--------------------------------------------------
--- Phase 2 Complete ---
=====================================
Scan Finished
Total duration: 0 seconds
Found 1 verified Ollama instances:
-------------------------------------
Instance: http://10.10.10.10:11434
  Installed Models (/api/tags):
    - gemma3:27b (Size: 27.4B, Quant: Q4_K_M)
    - hf.co/unsloth/gemma-3-27b-it-GGUF:Q4_K_M (Size: 27B, Quant: unknown)
    - R1984-gemma3:latest (Size: 11.8B, Quant: Q6_K)
    - tesslate-synthia:latest (Size: 27.0B, Quant: Q6_K)
    - gemmasutra-small-4b-v1a:latest (Size: 3.9B, Quant: Q8_0)
    - amoral_gemma3_q6k:latest (Size: 11.8B, Quant: Q6_K)
    - gemma3_27bablit:latest (Size: 27.0B, Quant: Q4_K_M)
    - qwen2.5:1.5b (Size: 1.5B, Quant: Q4_K_M)
    - gemmasutra3-12b:Q8 (Size: 11.8B, Quant: Q8_0)
    - moist-miqu-70B-i1-Q2_K:latest (Size: 69.0B, Quant: Q2_K)
    - QwQ-32B-Q4_k_m:latest (Size: 32.8B, Quant: Q4_K_M)
    - QwQ-32B-Preview-Q4_k_M:latest (Size: 32.8B, Quant: Q4_K_M)
    - mn-ink:latest (Size: 12.2B, Quant: Q6_K)
    - mn-lyra:latest (Size: 12.2B, Quant: Q6_K)
    - gemma3:4b (Size: 4.3B, Quant: Q4_K_M)
    - gemma3:1b (Size: 999.89M, Quant: Q4_K_M)
    - gemma3-4b:latest (Size: 3.9B, Quant: Q6_K)
    - qwq-rp-draft-v02:latest (Size: 1.5B, Quant: Q4_K_M)
    - fallen-gemma3:latest (Size: 3.9B, Quant: Q8_0)
    - theia-21b:latest (Size: 20.4B, Quant: Q6_K)
    - gemmasutra-mini:2b (Size: 2.6B, Quant: Q8_0)
    - fallen-mistral:latest (Size: 23.6B, Quant: Q4_K_M)
    - moondream:latest (Size: 1B, Quant: Q4_0)
    - granite3.2-vision:2b-q8_0 (Size: 2.5B, Quant: Q8_0)
    - deepseek-32b-uncensored:Q4 (Size: 32.8B, Quant: Q4_K_M)
    - dumpling:latest (Size: 1.5B, Quant: Q8_0)
    - cydonia-smol:latest (Size: 22.2B, Quant: Q4_K_M)
    - 2B-AD:latest (Size: 2.6B, Quant: Q6_K)
    - deepseek-14b-uncensored:latest (Size: 14.8B, Quant: Q4_K_M)
    - deepseek-r1:32b (Size: 32.8B, Quant: Q4_K_M)
    - gemmasutra9b:latest (Size: 9.2B, Quant: Q8_0)
    - sky-t1:latest (Size: 32.8B, Quant: Q4_K_M)
    - gemmasutra-pro:latest (Size: 27.2B, Quant: Q4_K_M)
    - llama3.2-vision:latest (Size: 9.8B, Quant: Q4_K_M)
    - cydonia:latest (Size: 22.2B, Quant: Q8_0)
    - fimbulvetr:latest (Size: 10.7B, Quant: Q8_0)
  Running Models (/api/ps):
    (No models currently running/loaded)
-------------------------------------
```

## License
This project is licensed under the MIT License - see the LICENSE file for details. 

## Disclaimer
This tool is intended for educational and research purposes only. Use it responsibly and ensure you have permission to scan any network or system. Unauthorized scanning may violate laws or terms of service.
